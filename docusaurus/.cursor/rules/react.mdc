---
description: React 18 component patterns, hooks, and best practices for Docusaurus theme and src components
globs:
  - "src/**/*.js"
  - "src/**/*.jsx"
alwaysApply: false
---

# React 18 Patterns

## Overview

This project uses React 18. Patterns below apply to functional components and hooks. When upgrading to React 19, consider useActionState, use(), and ref-as-prop.

---

## Component Patterns

### Use function components

```javascript
export function UserCard({ name, email, onEdit }) {
  return (
    <div className="card">
      <h3>{name}</h3>
      <p>{email}</p>
      {onEdit && <button onClick={onEdit}>Edit</button>}
    </div>
  );
}
```

### Use early returns

```javascript
export function UserProfile({ user }) {
  if (!user) return null;
  if (user.banned) return <BannedMessage />;
  return <ProfileCard user={user} />;
}
```

### Avoid nested conditionals in JSX

```javascript
// Bad
return (
  <div>
    {user && user.name && user.isActive && <span>{user.name}</span>}
  </div>
);

// Good
if (!user?.name || !user.isActive) return null;
return <span>{user.name}</span>;
```

---

## Hooks Best Practices

### useState

```javascript
const [count, setCount] = useState(0);
setCount(prev => prev + 1);
const [data, setData] = useState(() => computeExpensiveDefault());
```

### useEffect

```javascript
useEffect(() => {
  const subscription = api.subscribe(handler);
  return () => subscription.unsubscribe();
}, [handler]);

useEffect(() => {
  fetchUser(userId);
}, [userId]);
```

### useMemo and useCallback

```javascript
const sortedItems = useMemo(
  () => [...items].sort((a, b) => a.name.localeCompare(b.name)),
  [items]
);
const handleClick = useCallback(() => doSomething(id), [id]);
```

---

## State Management

### Lift state up

Keep shared state in the parent; pass callbacks and data as props.

### Context for global state

```javascript
const ThemeContext = createContext('light');

export function ThemeProvider({ children }) {
  const [theme, setTheme] = useState('light');
  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) throw new Error('useTheme must be within ThemeProvider');
  return context;
}
```

---

## Performance

### React.memo for expensive components

```javascript
const ExpensiveList = memo(function ExpensiveList({ items }) {
  return (
    <ul>
      {items.map(item => (
        <li key={item.id}>{item.name}</li>
      ))}
    </ul>
  );
});
```

### Avoid creating objects/arrays in render

Use useMemo for derived values passed as props.

---

## Error Boundaries

Use class components for error boundaries (getDerivedStateFromError); wrap tree sections that should not bring down the whole app.

---

## Common Mistakes

| Mistake | Fix |
|---------|-----|
| Missing dependency in useEffect | Add all dependencies |
| Creating objects/arrays in render | Move outside or useMemo |
| Mutating state directly | Always create new objects |
| Prop drilling through many levels | Use Context |

---

## Docusaurus-Specific

### Theme components (swizzling)

```javascript
import React from 'react';
import OriginalComponent from '@theme-original/ComponentName';

export default function ComponentWrapper(props) {
  return (
    <>
      <OriginalComponent {...props} />
      {/* Your additions */}
    </>
  );
}
```

### Docusaurus hooks

```javascript
import { useColorMode } from '@docusaurus/theme-common';
import useDocusaurusContext from '@docusaurus/useDocusaurusContext';

function MyComponent() {
  const { colorMode } = useColorMode();
  const { siteConfig } = useDocusaurusContext();
  return <div>{siteConfig.title}</div>;
}
```
